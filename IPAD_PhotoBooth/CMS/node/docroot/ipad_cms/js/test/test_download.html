<html>

<body>

<script type="text/javascript">

window.requestFileSystem  = window.requestFileSystem || window.webkitRequestFileSystem;

function onError(e) {
  console.log('Error', e);
  alert("error!");
  alert("code",e.code);
}

var xhr = new XMLHttpRequest();
xhr.open('GET', 'http://127.0.0.1/assets/complete.png', true);
xhr.responseType = 'blob';

xhr.onload = function(e) {

alert("onload1");
  window.requestFileSystem(TEMPORARY, 1024 * 1024, function(fs) {

alert("onload2");
    fs.root.getFile('zzzz.png', {create: true}, function(fileEntry) {

alert("onload3");
      fileEntry.createWriter(function(writer) {

        writer.onwrite = function(e) { console.log("on write"); alert("onwrite!");};
        writer.onerror = function(e) { console.log("on err");alert("onerror!"); };

        var blob = new Blob([xhr.response], {type: 'image/png'});

        writer.write(blob);
alert("after write!");

      }, onError);
    }, onError);
  }, onError);
};

alert("before send!");
xhr.send();

alert("after send!");

/*
//var bb = new (window.MozBlobBuilder || window.WebKitBlobBuilder || window.BlobBuilder)();
//bb.append(data);
//var blob = bb.getBlob();

var content = "abc123";    
var bb = new Blob();
//bb.append(content);
var blob = bb.getBlob();
blob = blob.slice(0, blob.size, 'text/octet-stream');
var fr = new FileReader(); 
fr.onload = function() {document.location = this.result;}
fr.readAsDataURL(blob);
*/
</script>

</body>

</html>
